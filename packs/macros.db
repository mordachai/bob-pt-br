{"name":"Pessoa (Atualiza Sozinha)","type":"script","author":"rZ8f3UuUb6MupaVU","img":"icons/environment/people/commoner.webp","scope":"global","command":"macroRun('Pessoa');\n\nasync function macroRun(macroName, compendiumName='bid-pt-br.macros') {  \n  let pack = game.packs.get(compendiumName);\n  let macro = ( await pack.getDocuments() ).find(i => (i.data.name==macroName) );\n  await macro.execute();    \n}","folder":null,"sort":0,"permission":{"default":0,"rZ8f3UuUb6MupaVU":3},"flags":{"core":{"sourceId":"Macro.8ZFOCS0YDrqq5I6Q"}},"_id":"B5fnvIyQ1n7tIQlO"}
{"name":"Pessoa","type":"script","author":"rZ8f3UuUb6MupaVU","img":"icons/svg/dice-target.svg","scope":"global","command":"/* Gerar Pessoa - v1.1\nSource: https://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/Forged%20in%20the%20Dark/BladesintheDark-Pessoa.js\nIcon: icons/environment/people/commoner.webp\n*/\n\n(async () => {\n  const nome = await drawFromTable('Pessoas - Nomes');\n  const sobrenome = await drawFromTable('Pessoas - Sobrenomes');\n  const traco = await drawFromTable('Pessoas - Traços');\n  const raizes = await drawFromTable('Pessoas - Raízes');\n  const aparencia = await drawFromTable('Pessoas - Aparência');\n  const estilo = await drawFromTable('Pessoas - Estilo');\n  const objetivo = await drawFromTable('Pessoas - Objetivos');\n  const metodosAcao = await drawFromTable('Pessoas - Métodos de Ação');\n  const peculiaridades = await drawFromTable('Pessoas - Peculiaridades');\n  const alcunhas = await drawFromTable('Pessoas - Alcunhas');\n  const profissao = await drawFromTable('Pessoas - Profissões');\n  const interesse = await drawFromTable('Pessoas - Interesses');\n\n  let msg = `<h2>${nome} ${sobrenome}</h2>`;\n  msg += `<ul><li>Nome + Sobrenome: <b>${nome} ${sobrenome}</b></li>`;\n  msg += `<li>Possível Alcunha: <b>${alcunhas}</b></li>`;\n  msg += `<li>Traço: <b>${traco}</b></li>`;\n  msg += `<li>Origens: <b>${raizes}</b></li>`;\n  msg += `<li>Aparência: <b>${aparencia}</b></li>`;\n  msg += `<li>Estilo: <b>${estilo}</b></li>`;\n  msg += `<li>Objetivo: <b>${objetivo}</b></li>`;\n  msg += `<li>Métodos de Ação: <b>${metodosAcao}</b></li>`;\n  msg += `<li>Interesse: <b>${interesse}</b></li>`;\n  msg += `<li>Peculiaridades: <b>${peculiaridades}</b></li>`;\n  msg += `<li>Profissão: <b>${profissao}</b></li></ul><br>`;\n  \n  let message=msg;\n\n  let data = {\n    name: `${nome} ${sobrenome}`,\n    content: msg\n  };\n  addEventListenerOnHtmlElement(\"#createNPC\", 'click', (e) => {    \n    createNPC(data);    \n  });          \n  \n  message+=`<button style=\"background:#d10000;color:white\" id=\"createNPC\">Criar</button>`;\n  \n  let chatData = {\n    content: message,\n    whisper : ChatMessage.getWhisperRecipients(\"GM\")\n  };  \n  ChatMessage.create(chatData, {});  \n\n})()\n\n/* Functions */\nasync function drawFromTable(tableName) {\n\n  let list_compendium = await game.packs.filter(p=>p.documentName=='RollTable');      \n  let inside = await list_compendium.filter( p=>p.metadata.label=='Tabelas' )[0].getDocuments();      \n  const table = await inside.filter( p=>p.name==tableName )[0];          \n  \n  if (!table) {\n    ui.notifications.warn(`Table ${tableName} not found.`, {});\n    return;\n  }\n  const output = await table.roll();\n  const result = output.results[0].data.text;\n  return result;  \n}\n\nfunction addEventListenerOnHtmlElement(element, event, func){    \n    Hooks.once(\"renderChatMessage\", (chatItem, html) => { // Use Hook to add event to chat message html element\n        html[0].querySelector(element).addEventListener(event, func);        \n    });\n} // end addEventListenerOnHtmlElement\n\nasync function createRandomNPC(data) {  \n  const instantNPC = await Actor.create(data);\n  await instantNPC.sheet.render(true);    \n}\n\nasync function createNPC(data) {  \n  const instantAdventure = await JournalEntry.create(data);\n  await instantAdventure.sheet.render(true);    \n}","folder":null,"sort":0,"permission":{"default":0,"rZ8f3UuUb6MupaVU":3},"flags":{"core":{"sourceId":"Macro.Up6BojA0M1IodgWu"}},"_id":"cp6H4jod1hDYYoOQ"}
